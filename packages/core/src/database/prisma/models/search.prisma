model SearchIndex {
  id               String    @id @default(cuid(2))
  name             String    @unique
  active           Boolean   @default(true)
  indexing         Boolean   @default(false)
  mediaIndexed     Int       @default(0)
  /// Fully qualified model ID of the embedding model to use for this index. `null` implies the vector provider is capable of embedding documents without an external model.
  embeddingModelId String?
  /// Vector database provider ID
  vectorProviderId String
  /// Provider-specific configuration
  config           Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  lastIndexedAt    DateTime?

  items SearchIndexItem[]

  @@index([embeddingModelId])
  @@index([vectorProviderId])
}

model SearchIndexItem {
  id         String                @id @default(cuid(2))
  /// Direct storage of the embedding vector
  // embedding    Unsupported("vector")?
  status     SearchIndexItemStatus @default(INDEXING)
  /// External ID of the document in the vector database
  externalId String                @unique
  createdAt  DateTime              @default(now())
  updatedAt  DateTime              @updatedAt

  indexId          String
  index            SearchIndex     @relation(fields: [indexId], references: [id], onDelete: Cascade)
  mediaContainerId String?
  mediaContainer   MediaContainer? @relation(fields: [mediaContainerId], references: [id], onDelete: SetNull)

  @@unique([indexId, mediaContainerId])
  @@index([indexId])
  @@index([status])
  @@index([mediaContainerId])
}

enum SearchIndexItemStatus {
  INDEXING
  INDEXED
  STALE
}
