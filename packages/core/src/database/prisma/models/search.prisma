model SearchIndex {
  id               String    @id @default(cuid(2))
  name             String    @unique
  active           Boolean   @default(true)
  indexing         Boolean   @default(false)
  /// Fully qualified model ID of the embedding model to use for this index. `null` implies the search provider is capable of embedding documents without an external model.
  embeddingModelId String?
  searchProviderId String
  /// Provider-specific configuration
  config           Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  lastIndexedAt    DateTime?

  items SearchIndexItem[]

  @@index([embeddingModelId])
  @@index([searchProviderId])
}

model SearchIndexItem {
  id        String                @id @default(cuid(2))
  status    SearchIndexItemStatus @default(INDEXING)
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt

  indexId String
  index   SearchIndex @relation(fields: [indexId], references: [id], onDelete: Cascade)
  assetId String?
  asset   Asset?      @relation(fields: [assetId], references: [id], onDelete: SetNull)

  @@unique([indexId, assetId])
  @@index([indexId])
  @@index([status])
}

enum SearchIndexItemStatus {
  INDEXING
  INDEXED
  STALE
}
